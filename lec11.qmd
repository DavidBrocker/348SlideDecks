---
title: "Paired Samples T-Test"
subtitle: "Lecture 10"
author: "Dave Brocker"
footer: "PSY 348 - Statistics for Psychology"
institute: "Farmingdale State College"
execute: 
  echo: true
format: 
  revealjs:
    theme: custom.scss
    width: 1600
    height: 900
    scrollable: true
    incremental: true   
    touch: true
    chalkboard: true
    lightbox: true
    code-fold: true
    code-line-numbers: true
    drop:
      engine: webr
      webr:
        packages:
         - ggplot2
         - dplyr
revealjs-plugins:
  - drop
---

## Introduction to Paired Samples t-Test

### What is a Paired Samples t-Test?

-   A statistical method used to compare the means of two related groups.
-   Commonly used when measuring the same group before and after an intervention or over two different conditions.

## Purpose of Paired Samples t-Test

### Why Use Paired Samples t-Test?

-   To determine if there is a statistically significant difference between two related group means.
-   Useful in psychology for assessing changes due to an intervention, therapy, or experiment.

## Formula for Paired Samples t-Test

### Mathematical Representation

-   **Formula**: $\large{t = \frac{\bar{d}}{{s_{\bar{d}}}/\sqrt{n}}} = \frac{\bar{d}}{\sigma}$
    -   $\bar{d}$: Mean of the differences between paired observations.
    -   $s_d$: Standard deviation of the differences.
    -   $n$: Number of pairs.

## Theoretical Formula Explanation

### Understanding Each Component

-   **Difference Mean** $\bar{d}$: Average of the differences between paired scores.
-   **Standard Deviation of Differences** $s_d$: Indicates how much individual differences deviate from the mean difference.
-   **Sample Size** $n$: Number of pairs, affecting the significance of results.

## Application of Paired Samples t-Test

### When to Apply This Test

-   **Pretest-Posttest Design**

    - Measure changes in the same group over time.
-   **Matched Pairs**

    - Compare two related groups, such as twins or matched participants.
-   **Repeated Measures**

    - Test the same group under different conditions or at different times.

## Paired Samples t-Test

### Application in Psychology Research

> A psychologist measures stress levels of a group before and after a mindfulness program.

**Steps**:

1.   Calculate the difference between pre- and post-intervention scores.

2.   Find the mean $\bar{d}$ and standard deviation $s_d$ of the differences.

3.   Apply the formula to calculate the t-value and check for significance.

## Paired Samples t-Test

### Application in Psychology Research

```{r}

# Load Packages
library(dplyr)
library(broom)
library(gt)

# Random Seed
set.seed(20)

# Create data
data <- 
  tibble(
  # Make a variable, `group` with 30 T1 and 30 T2
  group = rep(c("Time One","Time Two"), each = 30),
  # Make a variable, `score` with 60 scores
  score = c(rnorm(30,8,2),rnorm(30,4,1)) |> round(0)
) 

data |> 
  gt_preview() |> 
  opt_row_striping() |> 
  tab_options(
    table.font.size = 32,
    table.width = pct(70)
    )
```

## Paired Samples t-Test

### Compare Scores

```{r}
data_new <- 
  data |> 
  group_by(group) |> 
  mutate(
    id = paste0("Participant ",row_number()),
    group = ifelse(stringr::str_detect(group,"One"),"T1","T2")) |> 
  tidyr::pivot_wider(
                     names_from = group,
                     values_from = score
                     ) |> 
  ungroup() |> 
  mutate(
    D = T2-T1,
    Dfi = ifelse(stringr::str_detect(D,"^-"),paste0("(",D,")"),D)
  )

data_new |> 
  select(-D) |> 
  gt_preview() |> 
  opt_row_striping() |> 
    tab_options(
    table.font.size = 32,
    table.width = pct(70)
    )
```

## Paired Samples t-Test

### Construct the Formula ($\bar{D}$ \| $\sigma_{\bar{D}}$)

$$\large{t = \frac{D}{\frac{\sigma}{\sqrt{n}}} =  \frac{-3.26}{\frac{2.083}{\sqrt{30}}} = (-8.57)}$$

## Paired Samples t-Test

### Construct the Formula ($\bar{D}$ \| $\sigma_{\bar{D}}$)

```{r}

t.test(data$group,data$score,paired = TRUE) |> 
  tidy() |> 
  rename(
    D = estimate,
    t = statistic, 
    p = p.value,
    df = parameter) |> 
  mutate(
    `CI[ll,uu]` = paste0("[",conf.low |> round(2),", ",conf.high |> round(2),"]"),
    p = p |> round(10)
  ) |> 
  select(-conf.low:-alternative) |> 
  select(D,t,df,p,`CI[ll,uu]`) |> 
  gt() |> 
  fmt_auto() |> 
  opt_row_striping() |>   
  tab_options(
    table.font.size = 32,
    table.width = pct(70)
    )
```
-   D = mean difference of T2-T1
-   t = t-test statistic
-   df = n-1 (30-1)
-   p = probability results came from the Null Distribution
-   CI\[ll,uu\] = 95% CI of Mean Difference (D)


## Paired T-Tests

### Visualizing Results: Option 1

```{r}
library(ggplot2)
library(viridis)

data |> 
  ggplot(aes(group, score, fill = group)) + 
  stat_summary(
    fun = "mean",
    geom = "bar"
  ) + 
  stat_summary(
    fun.data = "mean_se",
    geom = "errorbar",
    width=.2
  ) +
  theme_minimal() +
  labs(
    x = "\nTreatment Group",
    y = "Stress Score\n",
    fill = "Time",
    title = "Mindfulness Intervention decreases stress levels\n"
  ) + 
  theme(
    plot.title.position =  "plot",
    plot.title = element_text(face = "bold")
  ) +
  scale_fill_viridis(discrete = TRUE, option = "E")
```

## Paired T-Tests

### Visualizing Results: Option 2

```{r}
library(ggplot2)
library(viridis)

data |> 
  ggplot(aes(group, score, color = group)) + 
  geom_jitter(aes(alpha = .2)) + 
  stat_summary(
    fun.data = "mean_se",
    geom = "line",
    group = 1,
    color = "black"
  ) + 
  stat_summary(
    fun.data = "mean_se",
    geom = "pointrange"
  ) +
  theme_minimal() +
  labs(
    x = "\nTreatment Group",
    y = "Stress Score\n",
    fill = "Time",
    title = "Mindfulness Intervention decreases stress levels\n"
  ) + 
  theme(
    plot.title.position =  "plot",
    plot.title = element_text(face = "bold"),
    legend.position = "none"
  ) +
  scale_color_manual(values = c("darkgreen","darkred"))
```

## Summary of Paired Samples t-Test

### Key Takeaways

-   Paired samples t-tests are ideal for comparing **two related** groups.
-   They help determine if interventions or conditions produce **significant changes**.
-   Remember to check **assumptions**: normality of differences and appropriate pairing.
