---
title: "Analysis of Variance"
subtitle: "Lecture 12"
author: "Dave Brocker"
footer: "PSY 348 - Statistics for Psychology"
institute: "Farmingdale State College"
format: 
  revealjs:
    theme: custom.scss
    scrollable: true
    width: 1600
    height: 900
    incremental: true   
    touch: true
    chalkboard: true
    lightbox: true
    code-fold: true
    drop:
      engine: webr
      webr:
        packages:
         - ggplot2
         - dplyr
revealjs-plugins:
  - drop
editor: 
  markdown: 
    wrap: 72
---

## Recap

### How Did We Get Here?

```{dot}
graph {
  
  node[shape = box, style = rounded]
  bgcolor="#E9F1EC"
  label="Independent Variable: \nCaffeine Content"
  labelloc="t"

  subgraph cluster_tt {
  bgcolor="white"
  style = rounded
  label="T Test"

    Coffee_T [label="Coffee"]
    Decaf_T [label="Decaf"]
  }
}
```

## Recap

### How Did We Get Here?

```{dot}
graph {

  node[shape = box, style = rounded]
  bgcolor="#E9F1EC"
  label="Independent Variable \nCaffeine Content"
  labelloc="t"

  subgraph cluster_tt {
    style = rounded
    bgcolor="white"
    label="T Test"

    Coffee_T [label="Coffee"]
    Decaf_T [label="Decaf"]
    
    Stress_T[label="Stress"]
    Stress_T2[label="Stress"]
    
    Coffee_T -- Stress_T
    Decaf_T  -- Stress_T2
    
  }

  subgraph cluster_anova {
    style = rounded
    label="ANOVA"
    bgcolor="white"
    Coffee_A [label="Coffee"]
    Decaf_A [label="Decaf"]
    Water [label="Water"]
    
    Stress_A1[label="Stress"]
    Stress_A2[label="Stress"]
    Stress_A3[label="Stress"]
    
    Coffee_A -- Stress_A1
    Decaf_A -- Stress_A2
    Water -- Stress_A3
  }

}

```

## Analysis of Variance

### ANOVA

ANOVA, like t-tests, compares the means of different groups to determine
if they differ significantly from one another.

::::: columns
::: {.column width="50%"}
-   ANOVA can examine independent variables with \[**more than 2
    groups**\].

-   ANOVA can also be used for just 2 groups.
:::

::: {.column width="50%"}
```{dot}
graph {

  node[shape = box, style = rounded]
  bgcolor="#E9F1EC"
  label="Independent Variable \nCaffeine Content"
  labelloc="t"

  subgraph cluster_anova {
    style = rounded
    label="ANOVA"
    bgcolor="white"
    Coffee_A [label="Coffee"]
    Decaf_A [label="Decaf"]
    Water [label="Water"]
    
    Stress_A1[label="Stress"]
    Stress_A2[label="Stress"]
    Stress_A3[label="Stress"]
    
    Coffee_A -- Stress_A1
    Decaf_A -- Stress_A2
    Water -- Stress_A3
  }

}
```
:::
:::::

## ANOVA

There are 3 types of ANOVA:

-   Between subjects

    -   Different participants are exposed to different levels of the IV

-   Within subjects (repeated measures ANOVA)

    -   The same participants are exposed to each level of the IV

-   Factorial Designs

    -   Participants experience different levels of one IV and levels of
        another IV

## ANOVA

### Between and Within

```{dot}
graph {

  node[shape = box, style = rounded]
  center="t"
  bgcolor="#E9F1EC"
  label="ANOVA Types"
  labelloc="t"

  subgraph cluster_anova {
    style = rounded
    label="Between Subjects ANOVA"
    bgcolor="white"
    IV
    
    Level1[label="IV Level 1"]
    Level2[label="IV Level 2"]
    Level3[label="IV Level 3"]
    
    Participants1[label = "Participants"]
    Participants2[label = "Participants"]
    Participants3[label = "Participants"]
    
    IV -- Participants1 -- Level1
    IV -- Participants2 --Level2
    IV -- Participants3 --Level3
    
  }
  
    subgraph cluster_wanova {
    style = rounded
    label="Within Subjects ANOVA"
    bgcolor="white"
    ParticipantsW [label="Participants"]
    IVW [label = "IV"]
    
    Level1W[label="IV Level 1"]
    Level2W[label="IV Level 2"]
    Level3W[label="IV Level 3"]
    
    ParticipantsW -- IVW
    IVW -- Level1W
    IVW -- Level2W
    IVW -- Level3W
    
  }
}
```

## ANOVA

### Factorial (Multiple IV's)

```{dot}
graph {

  node [shape=box, style=rounded, fontname="Poppins"];
  bgcolor="#E9F1EC";
  labelloc="t";
  label="Factorial ANOVA (3 × 2 Design)";

  # ---- Independent Variable 1 ----
  subgraph cluster_IV1 {
    style=rounded;
    label="IV₁: Type of Beverage";
    bgcolor="white";
    
    IV1_L1 [label="Coffee"];
    IV1_L2 [label="Decaf"];
    IV1_L3 [label="Water"];
  }

  # ---- Independent Variable 2 ----
  subgraph cluster_IV2 {
    style=rounded;
    label="IV₂: Time of Day";
    bgcolor="white";
    
    IV2_L1 [label="Morning"];
    IV2_L2 [label="Evening"];
  }

  # ---- Cells (Combinations) ----
  subgraph cluster_cells {
    style=rounded;
    label = ""
    bgcolor="white";
    
    C1 [label="Coffee + Morning"];
    C2 [label="Coffee + Evening"];
    C3 [label="Decaf + Morning"];
    C4 [label="Decaf + Evening"];
    C5 [label="Water + Morning"];
    C6 [label="Water + Evening"];
  }

  # ---- Outcome ----
  Outcome [label="Stress", shape=ellipse, style=filled, fillcolor="#FFF2CC"];

  # ---- Relationships ----
  IV1_L1 -- C1;
  IV1_L1 -- C2;
  IV1_L2 -- C3;
  IV1_L2 -- C4;
  IV1_L3 -- C5;
  IV1_L3 -- C6;
  IV2_L2 -- C2;
  IV2_L1 -- C3;
  IV2_L2 -- C4;
  IV2_L1 -- C5;
  IV2_L2 -- C6;

  # ---- Output Links ----
  C1 -- Outcome;
  C2 -- Outcome;
  C3 -- Outcome;
  C4 -- Outcome;
  C5 -- Outcome;
  C6 -- Outcome;

}


```

## Between subjects ANOVA

### Coffee Example Vol. 2

> A researcher wants to see whether it is the taste of coffee that is
> causing higher levels of happiness. He assigns 30 people to each
> condition. The experimental group drinks caffeinated coffee. The
> placebo group drinks decaf. The control group drinks water. All `3`
> groups complete a survey to measure their happiness on a scale of `1`
> to `10`.

-   What is $H_0$?

    -   $H_0: \mu_\text{Coffee} = \mu_\text{Placebo} = \mu_\text{Control}$

-   What is $H_A$?

    -   $H_A: \mu_\text{Coffee} > \mu_{\text{Placebo}} > \mu_\text{Control}$

## Between subjects ANOVA

### Coffee Example Vol. 2

> A researcher wants to see whether it is the taste of coffee that is
> causing higher levels of happiness. He assigns 30 people to each
> condition. The experimental group drinks caffeinated coffee. The
> placebo group drinks decaf. The control group drinks water. All `3`
> groups complete a survey to measure their happiness on a scale of `1`
> to `10`.

-   The experimental group has a mean happiness score `8`

-   The placebo group mean happiness score `6`

-   The control group mean happiness score `5`

    -   Is the group that drank coffee significantly happier than the
        other groups?

## Coffee Example Vol. 2

### Visualize

```{r}
library(dplyr)
library(ggplot2)

tibble(
  group = c("Coffee","Decaf","Water"),
  happy = c(8,6,5)
) |> 
  ggplot(aes(group,happy, fill = group)) + 
  geom_col(color = "black") + 
  theme_minimal() +
  labs(
    x = "\nCaffeine Content",
    y = "Happiness Score\n",
  )
```

## Coffee Example Vol. 2

### Why Not Do More T-Tests?

-   Recall that our $\alpha$ level is set at .05.\
    If we want to find out whether coffee affects happiness, we’d need
    **three t-tests**:

    -   $t_1: \mu_\text{Coffee} > \mu_\text{Placebo}$
    -   $t_2: \mu_\text{Coffee} > \mu_\text{Control}$
    -   $t_3: \mu_\text{Placebo} > \mu_\text{Control}$

## Why Not Do More T-Tests?

### The Problem

-   Each test is done *independently*

-   None accounts for the shared variability across all groups.

-   By running multiple t-tests, we **increase the probability of a
    false positive (Type I error)** and **ignore the combined
    structure** of the data.

-   ANOVA solves both problems by analyzing **all groups at once**,
    partitioning total variance into *between-group variance*
    (differences due to the treatment)\
    and *within-group variance* (random variation).

## Why Not Do More T-Tests?

### Alpha Inflation

-   Each hypothesis has a 5% chance of a false positive.

-   When we test them one-by-one, those chances **accumulate**,
    increasing the overall risk of error.

-   **Familywise Error Rate (FWE):**

    -   $\alpha_\text{FWE} = 1 - (1 - \alpha)^k$

    -   $\alpha_\text{FWE} = 1 - (0.95)^3 = 0.1426 \approx 14\%$

-   Even though each test uses $\alpha(.05)$, the overall chance of
    finding at least one “significant” difference **by chance** jumps to
    \~15%.

## Why Not Do More T-Tests?

### The Takeaway

> ANOVA protects against this inflation by giving us one overall test of
> group differences (F-statistic), keeping our Type I error at the
> intended 5%.

```{r}
library(dplyr)
library(broom)
library(gt)

cof <- 
  tibble(
  condition = 
    rep(c("Coffee","Placebo","Control"), 
        each = 30),
  score = c(rnorm(30,8,1) |> round(0),
            rnorm(30,6,1) |> round(0),
            rnorm(30,5,1) |> round(0))
  ) 

t1 <- t.test(data = cof |> 
         filter(condition != "Control"), 
       score~condition, var.equal = TRUE) |> 
  tidy() |> 
  rename(
    Mean1 = estimate1,
    Mean2 = estimate2
  )

t2 <- t.test(data = cof |> 
         filter(condition != "Placebo"), 
       score~condition, var.equal = TRUE) |> 
  tidy() |> 
  rename(
    Mean1 = estimate1,
    Mean2 = estimate2
  )

t3 <- t.test(data = cof |> 
         filter(condition != "Coffee"), 
       score~condition, var.equal = TRUE) |> 
  tidy() |> 
  rename(
    Mean1 = estimate1,
    Mean2 = estimate2
  )


t1 |> 
  bind_rows(t2,t3) |> 
  rename(
    t = statistic,
    D = estimate,
    p = p.value,
    df = parameter
  ) |> 
  select(-method, -alternative) |> 
  mutate(p = ifelse(p<.01, "<.01", p)) |> 
  gt() |> 
  fmt_auto() |> 
  cols_align(align = "center") |> 
  opt_row_striping() |> 
  tab_options(
    table.width = pct(75),
    table.font.size = 33,
    table.align = "left"
  )

```

## Between subjects ANOVA

-   Is the variance between the green, red, and blue dots greater than
    the variance across all of the dots?

-   Is the variability between groups large enough, relative to the
    variability within groups, to suggest that group means truly differ?

```{r}
library(dplyr)
library(gt)
library(gtsummary)
library(ggplot2)
cof <- 
  tibble(
  condition = 
    rep(c("Coffee","Placebo","Control"), 
        each = 30),
  score = c(rnorm(30,7.5,1),
            rnorm(30,5,1),
            rnorm(30,5,2))
  ) 

cof |> 
  ggplot(aes(condition, score, color = condition)) + 
  geom_jitter(alpha = .25)  +
  theme_minimal(
    base_size = 20,
    paper = "ghostwhite",
    ink = "black") + 
  labs(
    x = "\nCondition",
    y = "Score\n"
  ) +
  theme_sub_panel(
    grid.major = element_blank()
  )
```

## Between subjects ANOVA

Is the variance between the green, red, and blue dots greater than the
variance across all of the dots?

```{r}
cof |> 
    tbl_summary(
      by = "condition",
      statistic = list(all_continuous() ~ c("{mean}({var}, {sd})"))
      ) |> 
  as_gt() |> 
  opt_row_striping() |> 
  tab_options(
    table.width = pct(75),
    table.font.size = 33
  )
```

## Between subjects ANOVA

-   If it's all about the means, why is it called Analysis of Variance?
-   To compare the means, we are analyzing two types of variance:
-   Variance among all of the scores *(error group variance)*
-   Variance *between the groups (between group variance).*

## The F Statistic

-   ANOVA produces what we call the F statistic.

-   Why do we call it F?

    -   Ronald Fischer ™

## Calculating F

::: callout-tip
# ANOVA Formula

$F = \frac{MS_B}{MS_E}\\MS_B = \frac{SS_B}{df_E} = MS_E = \frac{SS_E}{df_E}\\df_B = k-1 = df_E = N - k$

:::

-   Where MS - Means Square

-   $_B$ = Between Group Variance

-   $_E$ = Within Group Variance (Error)

-   $SS$ = Sum of Squares

-   $k$ = Number of groups

-   $N$ = Number of participants


## Calculating F

### Calculating the variance

ANOVA looks at variance. To calculate the Variance:

::: callout-tip
# Variance

$\Large{s^2 = \frac{\sum(x-\bar{x})^2}{n-1}}$

:::

-   Divide by (degrees of freedom).

    -   **This is the variance**, but in ANOVA we also call it a Mean
        Squared (MS).

## Calculating means squared (SS)

-   $MS = \frac{SS}{df}$

-   Calculate the SS.

-   Divide the SS by the degrees of freedom.

## Calculating means squared (MS)

-   We will calculate a SS for the between group variance.

    -   How much variance in the data is from group differences?

-   We will calculate a SS for all the data.

    -   How much variance in the data is from random error?

## Between subjects ANOVA

-   $SS_{BG}$ = How much variance comes comes from the group
    differences?

-   $SS_{Error}$ = How much variance is there in total among all the
    data points?

## Calculating means squared (MS)

$MS_B = \frac{SS_B}{df_E} \\ MS_E = \frac{SS_E}{df_E}$

-   Divide the SS by their degrees of freedom.

## Degrees of Freedom

### The Group Project

> Imagine a group of 5 students is submitting a project, and the total score for the group must be 100 points combined.

-   The first `4` students can choose any score they want — say, `15`, `20`, `25`, and `10`.

-   But the 5th student’s score isn’t free anymore. It must be whatever makes the total = `100`. In other words, only 4 scores are “free to vary.”

-   That’s `n − 1 = 4` degrees of freedom.

## Degrees of Freedom

-   Between Groups ($df_{B}$) = k - 1

-   Within Groups ($df_E$) = N - k

    -   k is the number of groups in the independent variable.

-   Total $df_{Total}$= N - 1


## Calculating the Means Squared (MS)

-   $MS_B = \frac{SS_B}{df_E}$

-   $MS_E = \frac{SS_E}{df_E}$

## Calculating Between subjects anova

-   $\Large{F = \frac{MS_B}{MS_E}}$

## Between subjects anova Example

> Prof Brocker gives one group of `100` participants the `Super Secret Limitless Drug`. He gives another group of `100` participants a `placebo`. He gives the third group of `100` participants `nothing`. All participants then complete an IQ test. He wants to know if those who took the `SSLD` have significantly higher IQ than the placebo and the control groups.

-   What is the IV?

-   How many levels does it have?

-   What is the DV?

## Between subjects ANOVA Example

> Prof Brocker gives one group of `100` participants the `Super Secret Limitless Drug`. He gives another group of `100` participants a `placebo`. He gives the third group of `100` participants `nothing`. All participants then complete an IQ test. He wants to know if those who took the `SSLD` have significantly higher IQ than the placebo and the control groups.

-   What is the IV?

    -   Drug Taken

-   How many levels does it have?

    -   3 [SSLD, Placebo, Nothing]

-   What is the DV?

    -   IQ Score

## Between subjects ANOVA Example

> Prof Brocker gives one group of `100` participants the `Super Secret Limitless Drug`. He gives another group of `100` participants a `placebo`. He gives the third group of `100` participants `nothing`. All participants then complete an IQ test. He wants to know if those who took the `SSLD` have significantly higher IQ than the placebo and the control groups.

## Interpreting F

$MS_B$ is made up of $MS_E$ + the theoretical difference between groups:

-   $MS_B = \text{group difference} + MS_E$

-   $MS_B = \text{group difference (0)} + MS_E$

-   $MS_B = MS_E$

-   $F = \frac{MS_B}{MS_E}$

-   $F = 1$

## Interpreting f

-   When $F < 1$, it's not likely to be significant.

## Interpreting f

The MS~BG~ is made up of the MS~Error~ + the theoretical difference
between groups:

-   $MS_B = \text{group difference} + MS_E$

-   $MS_B = \text{(Number > 0)} + MS_E$

-   $F = \frac{\text{Difference} + MS_E}{{MS_E}}$

-   $F = Difference$

## Hypothesis testing: ANOVA

-   $F \le 1$ = Fail to reject the Null Hypothesis

-   $F \gt 1$ = Refer to p-value, Reject the Null Hypothesis

## Reporting F

> If asked to report findings in terms of the Null Hypothesis (H0), you should report findings as:

-   Reject $H_0$, or

-   Fail to Reject $H_0$

## Reporting F

If asked to report findings in general or for publication, you need to
report 5 things:

-   F(df for the between group MS, df for the error MS)

-   F-value

-   p-value

-   Mean and standard deviation of each group

## Reporting F

The group that watched took the SSLD (`M=118.43`, `s=1.02`) did not report significantly higher IQ compared to their peers in the control group (`M=116.12`, `s=0.98`), and the placebo group (`M=114.2. s =.91`),  `F(2,297) = .912, p = 0.25`.

## Reporting F

> There was not a significant difference in happiness between the groups, F (2, 297) = .912, p = 0.25.

## Identifying Degrees of Freedom
### One-Way ANOVA, Equal Groups

>A researcher compares three different study methods (flashcards, rereading, and practice testing) on exam performance. There are 15 students in each group.

-   What is $df_B$?

    - $15 \times 3 = 45$
    
    - $k-1 = 3-1 = 2$

-   What is $df_E$?

    - $df_E = N-k = 45-3 = 42$

## Identifying Degrees of Freedom
### One-Way ANOVA Unequal Groups

> A psychologist compares four types of therapy for anxiety. Group sizes are `10`, `12`, `14`, and `9` participants.

-   What is $df_B$?

    - $k = 4$
    
    - $k-1 = 4-1 = 3$

-   What is $df_E$?

    - $n=10+12+14+9 = 45$

    - $df_E = N-k = 45-4 = 41$

Question:
	1.	What is df₍between₎?
	2.	What is df₍within₎?

Answer Key:
	•	k = 4 groups
	•	N = 10 + 12 + 14 + 9 = 45 participants
	•	df₍between₎ = 4 - 1 = 3
	•	df₍within₎ = 45 - 4 = 41